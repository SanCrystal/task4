<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Staking Token</title>
    <style>
        .hide{
            display: none;
        }
        .container{
            width: 95vw;
            height: 95vh;
            margin:auto;
        }
        .staking-body{
            display: flex;
    justify-content: space-around;
    margin-top: 2rem;
        }
        .staking-card {
    background: -webkit-gradient( linear, left top, left bottom, from(#8134A3), to(#541D73));
    background: -o-linear-gradient( top, #8134A3 0%, #541D73 100%);
    background: linear-gradient( 180deg, #8134A3 0%, #541D73 100%);
    border-radius: 25px;
    position: relative;
    padding: 38px;
    margin-bottom: 38px;
    overflow: hidden;
}
.wrapper{
    display: flex;
    justify-content: space-between;
}
    </style>
</head>
<body>
    <div class="container">
        <div class="wrapper">
            <div></div>
            <div class="connect-wallet">
                <div class="wallet-address-output"></div>
                <div class="connected"></div>
                <div class="ms-auto mt-2 mt-lg-0 column-gap-12px  con-init navbar-nav">
                    <div class="w-mb-100 d-flex nav-item">
                        <!-- <form action="">
                            <input type="text" placeholder="paste wallet address" name="wallet-address" id="wallet-address"> -->
                            <button id="btn-connect">Connect Wallet</button>
                        <!-- </form> -->
                    </div>
                </div>
            </div>
        </div>
        <div class="staking-body">
            <div class="first">
                <div class="staking-card style-1">
                    <div class="staking-card-header"><span>Amount of MST Staked</span></div>
                    <div class="staking-card-body"><span>395</span></div>
                </div>
                <div class="staking-card style-3">
                    <div class="staking-card-header"><span>APY</span></div>
                    <div class="staking-card-body"><span>33.36%</span></div>
                </div>
            </div>
            <div class="second">
                <div class="staking-card style-2">
                    <div class=" staking-card-header"><span>Wallet balance</span></div>
                <div class="staking-card-body wallet-balance"><span>19651882.2453</span></div>
            </div>
            </div>
            <div class="third">    
                <div class="staking-card style-4 pb-4" style="margin-bottom: 25px;">
                    <div class="p-sidebar-card"><div class="staking-card-header">Staked</div>
                    <div class="staking-card-body">0.0000</div>
                </div>
                <hr class="">
                <div class="p-sidebar-card">
                    <div class="staking-card-header">Rewards (ETH)</div>
                    <div class="staking-card-footer mt-4">
                        <form action="/">
                            <div class="staking-card-body">
                                <input type="text" placeholder="Enter Amout to Stake" name="stake-input" id="stake-input">
                            </div>
                            <button class="btn-send btn-primary w-100 "  id="stake" >Stake</button>
                        </form>
                        
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.1/web3.min.js" integrity="sha512-GKw4QT/RccGJIwQxY3MhyiQ5pHrhQ8SuKFEafV+WcpOvtz7iYFQuQGFCvmGlHLctJTe8KrWU1FqvF7VOkEAJtw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- <script src="./walletconnect.js"></script> -->
    <script>

        
//         const contractAddress = "0xE8b674438aD04D7C0fD162d106CCd1288989DDD2";
//         const abiOfToken = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"staker","type":"address"}],"name":"addStakeholder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"buyer","type":"address"}],"name":"buyToken","outputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"staker","type":"address"}],"name":"calculateReward","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"combinedRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"combinedStake","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"staker","type":"address"},{"internalType":"uint256","name":"_stake","type":"uint256"}],"name":"createStake","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"distributeRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"stakeholder_address","type":"address"}],"name":"isStakeholder","outputs":[{"internalType":"bool","name":"","type":"bool"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"newRate","type":"uint256"}],"name":"modifyTokenBuyPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"rate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"staker","type":"address"},{"internalType":"uint256","name":"_stake","type":"uint256"}],"name":"removeStake","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"staker","type":"address"}],"name":"removeStakeholder","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"staker","type":"address"}],"name":"rewardOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"staker","type":"address"}],"name":"stakeOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"staker","type":"address"}],"name":"viewStakeholder","outputs":[],"stateMutability":"nonpayable","type":"function"}]
// const lomlContract = new web3.eth.Contract(abiOfToken, contractAddress)
// console.log(lomlContract.methods.name().call())
//display address
const walletOut = document.querySelector(".wallet-address-output");

      const btnConnect = document.getElementById('btn-connect');
      const btnSendTrx = document.querySelector('.btn-send');
btnSendTrx.addEventListener('click',async e =>{
   await sendTrx(0.3);
})

const sendTrx =async(amountOfEth)=>{
//get transaction parameters
const data = await $.ajax({
    method:"POST",
    url:"/buytoken",
    dataType:"json",
    contentType:"application/json",
    data:JSON.stringify({address:walletOut.innerHTML,amountOfEth}),
    success:(data)=>{
        console.log(data)
        return data},
    error:(error)=>{return error}
});
const transactionParameters =await data.txObject;
console.log("trax params",transactionParameters)
//     const transactionParameters = {
//   nonce: '0x00', // ignored by MetaMask
//   gasPrice: web3.utils.toHex(web3.utils.toWei('6', 'gwei')), // customizable by user during MetaMask confirmation.
//   gas: web3.utils.toHex(2100000), // customizable by user during MetaMask confirmation.
//   to: '0xE8b674438aD04D7C0fD162d106CCd1288989DDD2', // Required except during contract publications.
//   from: ethereum.selectedAddress, // must match user's active address.
//   value: web3.utils.toHex(web3.utils.toWei(String(amountOfEth), 'ether')), // Only required to send ether to the recipient from the initiating external account.
//   data:
//     '0x7f7465737432000000000000000000000000000000000000000000000000000000600057', // Optional, but used for defining smart contract creation and interaction.
//   chainId: '0x3', // Used to prevent transaction reuse across blockchains. Auto-filled by MetaMask.
// };

// txHash is a hex string
// As with any RPC call, it may throw an error
const txHash = await ethereum.request({
  method: 'eth_sendTransaction',
  params: [transactionParameters],
});
}





      btnConnect.addEventListener('click',async event=>{
        
        const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
const account = accounts[0];
walletOut.innerHTML = account;
console.log(account)
        // const walletAddress = document.getElementById('wallet-address').value;
        // console.log(walletAddress)
            event.preventDefault();
            // await $.ajax({
            // url:'/wallet',
            // method:'POST',
            // contentType:"application/json",
            // data:JSON.stringify({walletAddress}),
            // dataType:'json',
            // success:(data)=>{
            //     const walletOut = document.querySelector(".wallet-address-output");
            //     const connected = document.querySelector(".connected");
            //     const conInit = document.querySelector(".con-init");
            //     const walletBalance = document.querySelector(".wallet-balance");
            //     walletOut.innerHTML = data.data.walletAddress;
            //     connected.innerHTML = data.data.connectedMessage;
            //     walletBalance.innerHTML =`<span>${data.data.accountBalance}</span>`;
            //     conInit.classList.add("hide");
            // console.log(data)
            // },
            // error:(data)=>{
            //     console.log(data)
            // }
            // });
      })
        //add event listener
    
          //call staking make ajax request

          const stake = document.getElementById('stake');
        stake.addEventListener("click",async event=>{
            const inputData = document.getElementById("stake-input").value;
            event.preventDefault();
            await $.ajax({
            url:'/stake',
            method:'POST',
            contentType:"application/json",
            data:JSON.stringify({inputData}),
            dataType:'json',
            success:(data)=>{
            console.log(data)
            },
            error:(data)=>{
                console.log(data)
            }
            });

        });


    </script>
</body>
</html>